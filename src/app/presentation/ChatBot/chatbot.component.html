<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050;">
  <!-- Chat Button -->
  <button
    *ngIf="!isChatOpen"
    (click)="toggleChat()"
    class="btn btn-primary rounded-circle d-flex align-items-center justify-content-center shadow"
    style="width: 60px; height: 60px;"
    title="Open Chat"
  >
    <span *ngIf="!isLoading">Chat</span>
    <div *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </button>

  <!-- Chat Window -->
  <div
    *ngIf="isChatOpen"
    class="card mw-md-400px h-500px shadow-lg"
  >
    <!-- Header -->
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <span>Gym Bro Chatbot ðŸ’ª</span>
      <button
        (click)="toggleChat()"
        class="btn-close btn-close-white"
        aria-label="Close"
      ></button>
    </div>

    <!-- Messages -->
    <div class="card-body d-flex flex-column overflow-auto">
      <div *ngFor="let msg of messages" class="mb-2">
        <div [class.text-end]="msg.sender === 'user'" [class.text-start]="msg.sender === 'bot'">
          <span
            [class.bg-user-message]="msg.sender === 'user'"
            [class.bg-bot-message]="msg.sender === 'bot'"
            class="d-inline-block p-2 rounded chat-message"
            style="max-width: 80%; line-height: 1.5;">
            <markdown *ngIf="msg.sender === 'bot'" [data]="msg.text"></markdown>
            <span *ngIf="msg.sender === 'user'">{{msg.text}}</span>
          </span>
        </div>
      </div>
    </div>

    <!-- Input -->
    <div class="card-footer">
      <textarea
        [(ngModel)]="userInput"
        (keypress)="onKeyPress($event)"
        placeholder="Ask for a workout or fitness tips..."
        class="form-control"
        rows="2"
        [disabled]="isLoading"
      ></textarea>
    </div>
  </div>
</div>
