<section id="product-detailes" class="min-vh-100 py-5">
<div class="container mt-4">
  <!-- Product Details -->
  <div *ngIf="Product" class="row justify-content-center align-items-center shadow-lg background-dark p-5">
    <div class="col-md-6 p-3 text-center Details-image border-dark border-light">
      <img class="img-fluid"
      [src]="Product.imageUrl" [alt]="Product.name" style="max-height: 90vh; object-fit: contain;">
    </div>
    <div class="col-md-6 text-center">
      <h2 class="text-uppercase green-dark h1 fs-1">{{ Product.name }}</h2>
      <div class="mb-3">
        <span class="text-muted small fw-bold fs-5 muted-dark">{{ Product.categoryName }}</span>
      </div>
      <div class="mb-3">
        <span class="text-dark fw-bold fs-3 light-dark">{{ Product.price | number: '1.2-2' }} EGP</span>
      </div>
      <p class="text-muted fw-bold fs-5 muted-dark">{{ Product.description }}</p>
      <!-- Buttons -->
      <div class="d-flex justify-content-center gap-4 mb-4">
        <!-- Updated Add to Cart Button -->
        <button class="btn  fw-bold"
                (click)="addToCart(Product); $event.stopPropagation()"
                [disabled]="Product.stock <= 0"
                [ngClass]="{
                  'btn-success': !isInCart(Product),
                  'btn-danger': isInCart(Product)
                }">
          <i class="bi me-2"
             [class.bi-cart-plus]="!isInCart(Product)"
             [class.bi-cart-dash]="isInCart(Product)"></i>
          {{ isInCart(Product) ? 'Remove from Cart' : (Product.stock > 0 ? 'Add to Cart' : 'Out of Stock') }}
        </button>

        <!-- Wishlist Buttons -->
            <button *ngIf="!isInWishlist(Product.id)&&authService.isLoggedIn()"
            class="btn btn-light shadow-sm d-flex align-items-center justify-content-center"
            (click)="addToWishList(Product.id); $event.stopPropagation()"
            [disabled]="Product.stock <= 0">
            <i class="fa-regular fa-heart fs-5" [class.heart-animation]="animatedHeart[Product.id]"></i>
          </button>

            <!-- Remove from Wishlist -->
          <button *ngIf="isInWishlist(Product.id)&&authService.isLoggedIn()"
                  class="btn btn-light shadow-sm d-flex align-items-center justify-content-center"
                  (click)="removeFromWishList(Product.id); $event.stopPropagation()"
                  [disabled]="Product.stock <= 0">
            <i class="fa-solid fa-heart fs-5 text-danger" [class.heart-animation]="animatedHeart[Product.id]"></i>
          </button>

      </div>
    </div>
  </div>

 <!-- Reviews Section -->
<div *ngIf="Product" class="mt-4">
  <h4 class="green-dark text-center fs-1">Customer Reviews</h4>

<!-- Review Form -->
<div *ngIf="authService.isLoggedIn()" class="mt-4">
  <h4 class="green-dark mb-5"><span class="submitReview">Submit Your Review</span></h4>
  <form (ngSubmit)="submitReview()" #reviewForm="ngForm">
    <div class="form-group mb-3 ">
      <label for="rating" class="fs-5 fw-bolder form-label">Rating</label>
      <select [(ngModel)]="newReview.rating" name="rating" id="rating" class="form-select rounded" required>
        <option value="" disabled selected>Select a Rating</option>
        <option value="1">⭐ 1 Star</option>
        <option value="2">⭐⭐ 2 Stars</option>
        <option value="3">⭐⭐⭐ 3 Stars</option>
        <option value="4">⭐⭐⭐⭐ 4 Stars</option>
        <option value="5">⭐⭐⭐⭐⭐ 5 Stars</option>
      </select>
    </div>
    <div class="form-group mb-3">
      <label for="comment" class="fs-5 fw-bolder form-label">Comment</label>
      <textarea [(ngModel)]="newReview.comment" name="comment" class="form-control rounded" rows="3" required></textarea>
    </div>
    <div class="d-flex justify-content-center align-items-center my-5">
      <button type="submit" class="btn btn-outline-success mt-3 w-25" [disabled]="reviewForm.invalid || isSubmitting">
        <span *ngIf="!isSubmitting">Submit Review</span>
        <span *ngIf="isSubmitting">
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          Submitting...
        </span>
      </button>
    </div>
  </form>
</div>

  <!-- Display Reviews -->
  <div *ngIf="reviews.length > 0" class="mt-4">
    <div *ngFor="let review of reviews" class="review-item card shadow-sm mb-3">
      <div class="card-body">
        
        <!-- Stars -->
        <div class="mb-2">
          <ng-container *ngFor="let star of [1,2,3,4,5]">
            <i class="fa fa-star" [ngClass]="star <= review.rating ? 'text-warning' : 'text-secondary'"></i>
          </ng-container>
        </div>
  
        <!-- Comment -->
        <p class="card-text mb-2">{{ review.comment }}</p>
  
        <!-- Comment Info (Date) -->
        <div class="text-end text-muted" style="font-size: 0.8rem;">
          {{ review.createdAt | date:'shortDate' }}
        </div>
  
      </div>
    </div>
  </div>
  


  <div *ngIf="!reviews?.length">
    <p class="light-dark">No reviews yet. Be the first to review!</p>
  </div>
</div>

  <!-- Related Products (Category Products) -->
  <div *ngIf="CategoryProducts?.length" class="mt-4">
    <h4 class="my-3 green-dark">Related Products</h4>
    <div class="row">
      <div *ngFor="let relatedProduct of CategoryProducts" class="col-md-4 mb-4">
        <app-product [product]="relatedProduct"></app-product>
      </div>
    </div>
  </div>
</div>
</section>
